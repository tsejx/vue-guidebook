(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{219:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("Vue ä¿®æ”¹è§†å›¾çš„è¿‡ç¨‹å°±æ˜¯ "),a("code",[t._v("setter -> Dep -> Watcher -> patch -> View")]),t._v("ã€‚")]),t._v(" "),a("p",[t._v("è¿™èŠ‚é€šè¿‡ç¤ºä¾‹è§£é‡Š Vue çš„æ‰¹é‡å¼‚æ­¥æ›´æ–°ç­–ç•¥ã€‚")]),t._v(" "),a("p",[t._v("ğŸŒ° "),a("strong",[t._v("ç¤ºä¾‹ï¼š")])]),t._v(" "),a("p",[t._v("å½“æŒ‰ä¸‹ click æŒ‰é’®æ—¶å€™ï¼Œ"),a("code",[t._v("number")]),t._v(" ä¼šè¢«å¾ªç¯å¢åŠ  1000 æ¬¡ã€‚")]),t._v(" "),a("p",[t._v("å¦‚ä¹‹å‰æ‰€è¿°ï¼Œæ¯æ¬¡ "),a("code",[t._v("number")]),t._v(" å¢åŠ çš„æ—¶å€™ï¼Œéƒ½ä¼šè§¦å‘ "),a("code",[t._v("number")]),t._v(" çš„ "),a("code",[t._v("setter")]),t._v(" æ–¹æ³•ï¼Œä»è€Œæ ¹æ®ä¸Šè¿°æµç¨‹ç›´åˆ°æœ€åä¿®æ”¹çœŸå® DOMã€‚é‚£ä¹ˆåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒDOM ä¼šè¢«æ›´æ–° 1000 æ¬¡ã€‚")]),t._v(" "),a("p",[t._v("Vue è‚¯å®šä¸ä¼šä»¥å¦‚æ­¤ä½æ•ˆçš„æ–¹æ³•æ¥å¤„ç†ã€‚Vue åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯æ¬¡è§¦å‘æŸä¸ªæ•°æ®çš„ setter æ–¹æ³•åï¼Œå¯¹åº”çš„ Watcher å¯¹è±¡å…¶å®ä¼šè¢« push è¿›ä¸€ä¸ªé˜Ÿåˆ— queue ä¸­ï¼Œåœ¨ä¸‹ä¸€ä¸ª tick çš„æ—¶å€™å°†è¿™ä¸ªé˜Ÿåˆ— queue å…¨éƒ¨æ‹¿å‡ºæ¥ runï¼ˆWatcher ç±»çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨æ¥è§¦å‘ patch æ“ä½œï¼‰ä¸€éã€‚")]),t._v(" "),a("p",[t._v("é‚£ä¹ˆä»€ä¹ˆæ˜¯ä¸‹ä¸€ä¸ª Tick å‘¢ï¼Ÿ")]),t._v(" "),a("h2",{attrs:{id:"nexttick"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nexttick","aria-hidden":"true"}},[t._v("#")]),t._v(" nextTick")]),t._v(" "),a("p",[t._v("Vue å®ç°äº†ä¸€ä¸ª "),a("code",[t._v("nextTick")]),t._v(" å‡½æ•°ï¼Œä¼ å…¥ä¸€ä¸ª "),a("code",[t._v("cb")]),t._v("ï¼Œè¿™ä¸ª "),a("code",[t._v("cb")]),t._v(" ä¼šè¢«å­˜å‚¨åˆ°ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œåœ¨ä¸‹ä¸€ä¸ª tick æ—¶è§¦å‘é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰ "),a("code",[t._v("cb")]),t._v(" äº‹ä»¶ã€‚")]),t._v(" "),a("p",[t._v("å› ä¸ºç›®å‰æµè§ˆå™¨å¹³å°å¹¶æ²¡æœ‰å®ç° "),a("code",[t._v("nextTick")]),t._v(" æ–¹æ³•ï¼Œæ‰€ä»¥ Vue ä½¿ç”¨ "),a("code",[t._v("Promise")]),t._v("ã€"),a("code",[t._v("setTimeout")]),t._v("ã€"),a("code",[t._v("setImmediate")]),t._v(" ç­‰æ–¹å¼åœ¨ microtaskï¼ˆæˆ–æ˜¯ taskï¼‰ä¸­åˆ›å»ºä¸€ä¸ªäº‹ä»¶ï¼Œç›®çš„æ˜¯åœ¨å½“å‰è°ƒç”¨æ ˆæ‰§è¡Œå®Œæ¯•ä»¥åï¼ˆä¸ä¸€å®šç«‹å³ï¼‰æ‰ä¼šå»æ‰§è¡Œè¿™ä¸ªäº‹ä»¶ã€‚")]),t._v(" "),a("p",[t._v("ä¸‹é¢ä½¿ç”¨ "),a("code",[t._v("setTimeout")]),t._v(" ç®€å•æ¨¡æ‹Ÿè¯¥æ–¹æ³•ã€‚")]),t._v(" "),a("p",[t._v("é¦–å…ˆå®šä¹‰ä¸€ä¸ª "),a("code",[t._v("callbacks")]),t._v(" æ•°ç»„ç”¨äºå­˜å‚¨ "),a("code",[t._v("nextTick")]),t._v("ï¼Œåœ¨ä¸‹ä¸€ä¸ª tick å¤„ç†è¿™äº›å›è°ƒå‡½æ•°ä¹‹å‰ï¼Œæ‰€æœ‰çš„ "),a("code",[t._v("cb")]),t._v(" éƒ½ä¼šè¢«å­˜åœ¨è¿™ä¸ª "),a("code",[t._v("callbacks")]),t._v(" æ•°ç»„ä¸­ã€‚"),a("code",[t._v("pending")]),t._v(" æ˜¯ä¸€ä¸ªæ ‡è®°ä½ï¼Œä»£è¡¨ä¸€ä¸ªç­‰å¾…çš„çŠ¶æ€ã€‚")]),t._v(" "),a("p",[a("code",[t._v("setTimeout")]),t._v(" ä¼šåœ¨ task ä¸­åˆ›å»ºä¸€ä¸ªäº‹ä»¶ "),a("code",[t._v("flushCallbacks")]),t._v("ï¼Œ"),a("code",[t._v("flushCallbacks")]),t._v(" åˆ™ä¼šåœ¨æ‰§è¡Œæ—¶å°† "),a("code",[t._v("callbacks")]),t._v(" ä¸­çš„æ‰€æœ‰ "),a("code",[t._v("cb")]),t._v(" ä¾æ¬¡æ‰§è¡Œã€‚")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" callbacks "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" pending "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("nextTick")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("cb")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  callbacks"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("pending"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    pending "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("flushCallbacks"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("flushCallbacks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  pending "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" copies "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" callbacks"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("slice")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  callbacks"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" copies"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    copies"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"å†å†™-watcher"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å†å†™-watcher","aria-hidden":"true"}},[t._v("#")]),t._v(" å†å†™ Watcher")]),t._v(" "),a("p",[t._v("ç¬¬ä¸€ä¸ªä¾‹å­ä¸­ï¼Œå½“æˆ‘ä»¬å°† "),a("code",[t._v("number")]),t._v(" å¢åŠ  1000 æ¬¡æ—¶ï¼Œå…ˆå°†å¯¹åº”çš„ "),a("code",[t._v("Watcher")]),t._v(" å¯¹è±¡ç»™ "),a("code",[t._v("push")]),t._v(" è¿›ä¸€ä¸ªé˜Ÿåˆ— "),a("code",[t._v("queue")]),t._v(" ä¸­å»ï¼Œç­‰ä¸‹ä¸ª tick çš„æ—¶å€™å†å»æ‰§è¡Œï¼Œè¿™æ ·åšæ˜¯å¯¹çš„ã€‚ä½†æ˜¯ä¼šå‡ºç°å¦ä¸€ä¸ªé—®é¢˜ã€‚")]),t._v(" "),a("p",[t._v("å› æ­¤ "),a("code",[t._v("number")]),t._v(" æ‰§è¡Œåè‡ªå¢æ“ä½œåå¯¹åº”çš„ "),a("code",[t._v("Watcher")]),t._v(" å¯¹è±¡éƒ½æ˜¯åŒä¸€ä¸ªï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦åœ¨ä¸‹ä¸€ä¸ª tick çš„æ—¶å€™æ‰§è¡Œ 1000 ä¸ªåŒæ ·çš„ Warcher å¯¹è±¡å»ä¿®æ”¹æ´é¢ï¼Œè€Œæ˜¯åªéœ€è¦æ‰§è¡Œä¸€ä¸ª "),a("code",[t._v("Watcher")]),t._v(" å¯¹è±¡ï¼Œä½¿å…¶å°†ç•Œé¢ä¸Šçš„ 0 ç¼–ç¨‹ 1000 å³å¯ã€‚")]),t._v(" "),a("p",[t._v("é‚£ä¹ˆï¼Œæˆ‘ä»¬å°±éœ€è¦æ‰§è¡Œä¸€ä¸ªè¿‡æ»¤çš„æ“ä½œï¼ŒåŒä¸€ä¸ª Watcher åœ¨åŒä¸€ä¸ªçš„ "),a("code",[t._v("Watcher")]),t._v(" åœ¨ç›¸åŒ tick çš„æ—¶å€™åº”è¯¥åªè¢«æ‰§è¡Œä¸€æ¬¡ï¼Œä¹Ÿå°±æ˜¯è¯´é˜Ÿåˆ— "),a("code",[t._v("queue")]),t._v(" ä¸­ä¸åº”è¯¥å‡ºç°é‡å¤çš„ "),a("code",[t._v("Watcher")]),t._v(" å¯¹è±¡ã€‚")]),t._v(" "),a("p",[t._v("Vue æºç ä¸ºæ¯ä¸ª "),a("code",[t._v("Watcher")]),t._v(" éƒ½æä¾›äº†å”¯ä¸€çš„ "),a("code",[t._v("id")]),t._v(" ç”¨äºæ ‡è¯†ã€‚")]),t._v(" "),a("p",[t._v("å®ç° "),a("code",[t._v("update")]),t._v(" æ–¹æ³•ï¼Œåœ¨ä¿®æ”¹æ•°æ®åç”± "),a("code",[t._v("Dep")]),t._v(" æ¥è°ƒç”¨ï¼Œè€Œ "),a("code",[t._v("run")]),t._v(" æ–¹æ³•æ‰æ˜¯çœŸæ­£çš„è§¦å‘ "),a("code",[t._v("patch")]),t._v(" æ›´æ–°è§†å›¾çš„æ–¹æ³•ã€‚")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" uid "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Watcher")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("constructor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v("uid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("update")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'watch'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("' update'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("queueWatcher")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'watch'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("' ViewRendring'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"queuewatcher"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#queuewatcher","aria-hidden":"true"}},[t._v("#")]),t._v(" queueWatcher")]),t._v(" "),a("p",[t._v("å°† "),a("code",[t._v("Watcher")]),t._v(" å¯¹è±¡è‡ªèº«ä¼ é€’ç»™ "),a("code",[t._v("queueWatcher")]),t._v(" æ–¹æ³•ã€‚")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" has "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" queue "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" waiting "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("queueWatcher")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("watcher")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" watcher"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("has"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    has"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    queue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("watcher"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("waiting"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      waiting "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("nextTick")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("flushSchedulerQueue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("è¿™é‡Œä½¿ç”¨ä¸€ä¸ªå«åš "),a("code",[t._v("has")]),t._v(" çš„ mapï¼Œé‡Œé¢å­˜æ”¾ id -> true(false) çš„å½¢å¼ï¼Œç”¨åŠ›å•Šåˆ¤æ–­æ˜¯å¦å·²ç»å­˜åœ¨ç›¸åŒçš„ "),a("code",[t._v("Watcher")]),t._v(" å¯¹è±¡ï¼ˆè¿™æ ·æ¯”æ¯æ¬¡éƒ½å»éå† "),a("code",[t._v("queue")]),t._v(" æ•ˆç‡ä¸Šä¼šé«˜å¾ˆå¤šï¼‰ã€‚")]),t._v(" "),a("p",[t._v("å¦‚æœç›®å‰é˜Ÿåˆ— "),a("code",[t._v("queue")]),t._v(" ä¸­è¿˜æ²¡æœ‰è¿™ä¸ª "),a("code",[t._v("Watcher")]),t._v(" å¯¹è±¡ï¼Œåˆ™è¯¥å¯¹è±¡ä¼šè¢« "),a("code",[t._v("push")]),t._v(" è¿›é˜Ÿåˆ— "),a("code",[t._v("queue")]),t._v(" ä¸­å»ã€‚")]),t._v(" "),a("p",[a("code",[t._v("waiting")]),t._v(" æ˜¯ä¸€ä¸ªæ ‡è®°ä½ï¼Œæ ‡è®°æ˜¯å¦å·²ç»å‘ "),a("code",[t._v("nextTick")]),t._v(" ä¼ é€’äº† "),a("code",[t._v("flushSchedulerQueue")]),t._v(" æ–¹æ³•ï¼Œåœ¨ä¸‹ä¸€ä¸ª tick æ‰§è¡Œæ—¶ "),a("code",[t._v("flushSchedulerQueue")]),t._v(" æ–¹æ³•æ¥ flush é˜Ÿåˆ— "),a("code",[t._v("queue")]),t._v("ï¼Œæ‰§è¡Œå®ƒé‡Œé¢çš„æ‰€æœ‰ "),a("code",[t._v("Watcher")]),t._v(" å¯¹è±¡çš„ "),a("code",[t._v("run")]),t._v(" æ–¹æ³•ã€‚")]),t._v(" "),a("h2",{attrs:{id:"flushschedulerqueue"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#flushschedulerqueue","aria-hidden":"true"}},[t._v("#")]),t._v(" flushSchedulerQueue")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("flushSchedulerQueue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" watcher"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("index "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" index "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" queue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" index"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    watcher "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" watcher"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    has"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    watcher"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  waiting "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("æ¨¡æ‹Ÿæ›´æ–°ç›¸åŒçš„ä¾èµ–ã€‚")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" watch1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Watcher")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" watch2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Watcher")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nwatcher1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("update")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nwatcher1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("update")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nwatcher2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("update")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("è¿™é‡Œå…ˆ new ä¸¤ä¸ª "),a("code",[t._v("Watcher")]),t._v(" å¯¹è±¡ï¼Œå› ä¸ºä¿®æ”¹äº† "),a("code",[t._v("data")]),t._v(" çš„æ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¨¡æ‹Ÿè§¦å‘äº†ä¸¤æ¬¡ "),a("code",[t._v("watch1")]),t._v(" çš„ "),a("code",[t._v("update")]),t._v(" ä»¥åŠä¸€æ¬¡ "),a("code",[t._v("watch2")]),t._v(" çš„ "),a("code",[t._v("update")]),t._v("ã€‚")])])},[],!1,null,null,null);s.default=e.exports}}]);