<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vue Guidebook</title>
    <meta name="description" content="">
    <link rel="icon" href="favicon.ico">
    
    <link rel="preload" href="/vue-guidebook/assets/css/0.styles.41f65d15.css" as="style"><link rel="preload" href="/vue-guidebook/assets/js/app.523c8c0b.js" as="script"><link rel="preload" href="/vue-guidebook/assets/js/2.e151b532.js" as="script"><link rel="preload" href="/vue-guidebook/assets/js/22.53a27428.js" as="script"><link rel="prefetch" href="/vue-guidebook/assets/js/10.63bd83ed.js"><link rel="prefetch" href="/vue-guidebook/assets/js/11.739346ea.js"><link rel="prefetch" href="/vue-guidebook/assets/js/12.0acea19a.js"><link rel="prefetch" href="/vue-guidebook/assets/js/13.d7901dfc.js"><link rel="prefetch" href="/vue-guidebook/assets/js/14.8e9c8e3a.js"><link rel="prefetch" href="/vue-guidebook/assets/js/15.3677ed14.js"><link rel="prefetch" href="/vue-guidebook/assets/js/16.2a3d4120.js"><link rel="prefetch" href="/vue-guidebook/assets/js/17.338127a8.js"><link rel="prefetch" href="/vue-guidebook/assets/js/18.39032579.js"><link rel="prefetch" href="/vue-guidebook/assets/js/19.81ba07c0.js"><link rel="prefetch" href="/vue-guidebook/assets/js/20.388c7930.js"><link rel="prefetch" href="/vue-guidebook/assets/js/21.d0a47a45.js"><link rel="prefetch" href="/vue-guidebook/assets/js/23.39c05ea6.js"><link rel="prefetch" href="/vue-guidebook/assets/js/24.2c5a8daf.js"><link rel="prefetch" href="/vue-guidebook/assets/js/25.c7469bc0.js"><link rel="prefetch" href="/vue-guidebook/assets/js/26.1bee8a8f.js"><link rel="prefetch" href="/vue-guidebook/assets/js/27.501801ce.js"><link rel="prefetch" href="/vue-guidebook/assets/js/28.8622c17d.js"><link rel="prefetch" href="/vue-guidebook/assets/js/3.6dbb5a30.js"><link rel="prefetch" href="/vue-guidebook/assets/js/4.181d0df0.js"><link rel="prefetch" href="/vue-guidebook/assets/js/5.d138a437.js"><link rel="prefetch" href="/vue-guidebook/assets/js/6.df102af9.js"><link rel="prefetch" href="/vue-guidebook/assets/js/7.e62a8200.js"><link rel="prefetch" href="/vue-guidebook/assets/js/8.bf43895d.js"><link rel="prefetch" href="/vue-guidebook/assets/js/9.3cb9bd08.js">
    <link rel="stylesheet" href="/vue-guidebook/assets/css/0.styles.41f65d15.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vue-guidebook/" class="home-link router-link-active"><img src="/vue-guidebook/favicon.png" alt="Vue Guidebook" class="logo"> <span class="site-name can-hide">Vue Guidebook</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vue-guidebook/recommend/" class="nav-link">æ¨è</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">æ›´å¤š</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://tsejx.github.io/JavaScript-Guidebook/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaScript Guidebook
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://tsejx.github.io/CSS-Guidebook/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSS Guidebook
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://tsejx.github.io/Git-Guidebook/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Git Guidebook
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <a href="https://github.com/tsejx/Vue-Guidebook" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vue-guidebook/recommend/" class="nav-link">æ¨è</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">æ›´å¤š</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://tsejx.github.io/JavaScript-Guidebook/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaScript Guidebook
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://tsejx.github.io/CSS-Guidebook/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSS Guidebook
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://tsejx.github.io/Git-Guidebook/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Git Guidebook
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <a href="https://github.com/tsejx/Vue-Guidebook" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>åŸºæœ¬æ¦‚å¿µ</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vue-guidebook/concept/directive.html" class="sidebar-link">æŒ‡ä»¤</a></li><li><a href="/vue-guidebook/concept/event.html" class="sidebar-link">äº‹ä»¶</a></li><li><a href="/vue-guidebook/concept/slot.html" class="sidebar-link">æ’æ§½</a></li><li><a href="/vue-guidebook/concept/lifecycle.html" class="sidebar-link">ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>ç»„ä»¶åŒ–</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vue-guidebook/component/component.html" class="sidebar-link">ç»„ä»¶åŒ–</a></li><li><a href="/vue-guidebook/component/interation.html" class="sidebar-link">ç»„ä»¶é€šä¿¡</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>å“åº”å¼åŸç†</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vue-guidebook/reactivity/lifecycle.html" class="sidebar-link">ç”Ÿå‘½å‘¨æœŸ</a></li><li><a href="/vue-guidebook/reactivity/reactivity.html" class="sidebar-link">å“åº”å¼åŸç†</a></li><li><a href="/vue-guidebook/reactivity/async-update-queue.html" class="sidebar-link">å¼‚æ­¥æ›´æ–°é˜Ÿåˆ—</a></li><li><a href="/vue-guidebook/reactivity/next-tick.html" class="sidebar-link">nextTick</a></li><li><a href="/vue-guidebook/reactivity/virtual-dom.html" class="sidebar-link">è™šæ‹Ÿ DOM</a></li><li><a href="/vue-guidebook/reactivity/ssr.html" class="sidebar-link">æœåŠ¡ç«¯æ¸²æŸ“</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>ç¼–è¯‘</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vue-guidebook/compile/introduction.html" class="sidebar-link">ä»£ç ç¼–è¯‘</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>ç”Ÿæ€</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vue-guidebook/ecosystem/vue-router.html" class="sidebar-link">Vue Router</a></li><li><a href="/vue-guidebook/ecosystem/vuex.html" class="sidebar-link">Vuex</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>Vue ä¿®æ”¹è§†å›¾çš„è¿‡ç¨‹å°±æ˜¯ <code>setter -&gt; Dep -&gt; Watcher -&gt; patch -&gt; View</code>ã€‚</p> <p>è¿™èŠ‚é€šè¿‡ç¤ºä¾‹è§£é‡Š Vue çš„æ‰¹é‡å¼‚æ­¥æ›´æ–°ç­–ç•¥ã€‚</p> <p>ğŸŒ° <strong>ç¤ºä¾‹ï¼š</strong></p> <p>å½“æŒ‰ä¸‹ click æŒ‰é’®æ—¶å€™ï¼Œ<code>number</code> ä¼šè¢«å¾ªç¯å¢åŠ  1000 æ¬¡ã€‚</p> <p>å¦‚ä¹‹å‰æ‰€è¿°ï¼Œæ¯æ¬¡ <code>number</code> å¢åŠ çš„æ—¶å€™ï¼Œéƒ½ä¼šè§¦å‘ <code>number</code> çš„ <code>setter</code> æ–¹æ³•ï¼Œä»è€Œæ ¹æ®ä¸Šè¿°æµç¨‹ç›´åˆ°æœ€åä¿®æ”¹çœŸå® DOMã€‚é‚£ä¹ˆåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒDOM ä¼šè¢«æ›´æ–° 1000 æ¬¡ã€‚</p> <p>Vue è‚¯å®šä¸ä¼šä»¥å¦‚æ­¤ä½æ•ˆçš„æ–¹æ³•æ¥å¤„ç†ã€‚Vue åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯æ¬¡è§¦å‘æŸä¸ªæ•°æ®çš„ setter æ–¹æ³•åï¼Œå¯¹åº”çš„ Watcher å¯¹è±¡å…¶å®ä¼šè¢« push è¿›ä¸€ä¸ªé˜Ÿåˆ— queue ä¸­ï¼Œåœ¨ä¸‹ä¸€ä¸ª tick çš„æ—¶å€™å°†è¿™ä¸ªé˜Ÿåˆ— queue å…¨éƒ¨æ‹¿å‡ºæ¥ runï¼ˆWatcher ç±»çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨æ¥è§¦å‘ patch æ“ä½œï¼‰ä¸€éã€‚</p> <p>é‚£ä¹ˆä»€ä¹ˆæ˜¯ä¸‹ä¸€ä¸ª Tick å‘¢ï¼Ÿ</p> <h2 id="nexttick"><a href="#nexttick" aria-hidden="true" class="header-anchor">#</a> nextTick</h2> <p>Vue å®ç°äº†ä¸€ä¸ª <code>nextTick</code> å‡½æ•°ï¼Œä¼ å…¥ä¸€ä¸ª <code>cb</code>ï¼Œè¿™ä¸ª <code>cb</code> ä¼šè¢«å­˜å‚¨åˆ°ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œåœ¨ä¸‹ä¸€ä¸ª tick æ—¶è§¦å‘é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰ <code>cb</code> äº‹ä»¶ã€‚</p> <p>å› ä¸ºç›®å‰æµè§ˆå™¨å¹³å°å¹¶æ²¡æœ‰å®ç° <code>nextTick</code> æ–¹æ³•ï¼Œæ‰€ä»¥ Vue ä½¿ç”¨ <code>Promise</code>ã€<code>setTimeout</code>ã€<code>setImmediate</code> ç­‰æ–¹å¼åœ¨ microtaskï¼ˆæˆ–æ˜¯ taskï¼‰ä¸­åˆ›å»ºä¸€ä¸ªäº‹ä»¶ï¼Œç›®çš„æ˜¯åœ¨å½“å‰è°ƒç”¨æ ˆæ‰§è¡Œå®Œæ¯•ä»¥åï¼ˆä¸ä¸€å®šç«‹å³ï¼‰æ‰ä¼šå»æ‰§è¡Œè¿™ä¸ªäº‹ä»¶ã€‚</p> <p>ä¸‹é¢ä½¿ç”¨ <code>setTimeout</code> ç®€å•æ¨¡æ‹Ÿè¯¥æ–¹æ³•ã€‚</p> <p>é¦–å…ˆå®šä¹‰ä¸€ä¸ª <code>callbacks</code> æ•°ç»„ç”¨äºå­˜å‚¨ <code>nextTick</code>ï¼Œåœ¨ä¸‹ä¸€ä¸ª tick å¤„ç†è¿™äº›å›è°ƒå‡½æ•°ä¹‹å‰ï¼Œæ‰€æœ‰çš„ <code>cb</code> éƒ½ä¼šè¢«å­˜åœ¨è¿™ä¸ª <code>callbacks</code> æ•°ç»„ä¸­ã€‚<code>pending</code> æ˜¯ä¸€ä¸ªæ ‡è®°ä½ï¼Œä»£è¡¨ä¸€ä¸ªç­‰å¾…çš„çŠ¶æ€ã€‚</p> <p><code>setTimeout</code> ä¼šåœ¨ task ä¸­åˆ›å»ºä¸€ä¸ªäº‹ä»¶ <code>flushCallbacks</code>ï¼Œ<code>flushCallbacks</code> åˆ™ä¼šåœ¨æ‰§è¡Œæ—¶å°† <code>callbacks</code> ä¸­çš„æ‰€æœ‰ <code>cb</code> ä¾æ¬¡æ‰§è¡Œã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> callbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> pending <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token parameter">cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  callbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pending<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    pending <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span>flushCallbacks<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">flushCallbacks</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  pending <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> copies <span class="token operator">=</span> callbacks<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  callbacks<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> copies<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    copies<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="å†å†™-watcher"><a href="#å†å†™-watcher" aria-hidden="true" class="header-anchor">#</a> å†å†™ Watcher</h2> <p>ç¬¬ä¸€ä¸ªä¾‹å­ä¸­ï¼Œå½“æˆ‘ä»¬å°† <code>number</code> å¢åŠ  1000 æ¬¡æ—¶ï¼Œå…ˆå°†å¯¹åº”çš„ <code>Watcher</code> å¯¹è±¡ç»™ <code>push</code> è¿›ä¸€ä¸ªé˜Ÿåˆ— <code>queue</code> ä¸­å»ï¼Œç­‰ä¸‹ä¸ª tick çš„æ—¶å€™å†å»æ‰§è¡Œï¼Œè¿™æ ·åšæ˜¯å¯¹çš„ã€‚ä½†æ˜¯ä¼šå‡ºç°å¦ä¸€ä¸ªé—®é¢˜ã€‚</p> <p>å› æ­¤ <code>number</code> æ‰§è¡Œåè‡ªå¢æ“ä½œåå¯¹åº”çš„ <code>Watcher</code> å¯¹è±¡éƒ½æ˜¯åŒä¸€ä¸ªï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦åœ¨ä¸‹ä¸€ä¸ª tick çš„æ—¶å€™æ‰§è¡Œ 1000 ä¸ªåŒæ ·çš„ Warcher å¯¹è±¡å»ä¿®æ”¹æ´é¢ï¼Œè€Œæ˜¯åªéœ€è¦æ‰§è¡Œä¸€ä¸ª <code>Watcher</code> å¯¹è±¡ï¼Œä½¿å…¶å°†ç•Œé¢ä¸Šçš„ 0 ç¼–ç¨‹ 1000 å³å¯ã€‚</p> <p>é‚£ä¹ˆï¼Œæˆ‘ä»¬å°±éœ€è¦æ‰§è¡Œä¸€ä¸ªè¿‡æ»¤çš„æ“ä½œï¼ŒåŒä¸€ä¸ª Watcher åœ¨åŒä¸€ä¸ªçš„ <code>Watcher</code> åœ¨ç›¸åŒ tick çš„æ—¶å€™åº”è¯¥åªè¢«æ‰§è¡Œä¸€æ¬¡ï¼Œä¹Ÿå°±æ˜¯è¯´é˜Ÿåˆ— <code>queue</code> ä¸­ä¸åº”è¯¥å‡ºç°é‡å¤çš„ <code>Watcher</code> å¯¹è±¡ã€‚</p> <p>Vue æºç ä¸ºæ¯ä¸ª <code>Watcher</code> éƒ½æä¾›äº†å”¯ä¸€çš„ <code>id</code> ç”¨äºæ ‡è¯†ã€‚</p> <p>å®ç° <code>update</code> æ–¹æ³•ï¼Œåœ¨ä¿®æ”¹æ•°æ®åç”± <code>Dep</code> æ¥è°ƒç”¨ï¼Œè€Œ <code>run</code> æ–¹æ³•æ‰æ˜¯çœŸæ­£çš„è§¦å‘ <code>patch</code> æ›´æ–°è§†å›¾çš„æ–¹æ³•ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> uid <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Watcher</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token operator">++</span>uid<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'watch'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">+</span> <span class="token string">' update'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">queueWatcher</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'watch'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">+</span> <span class="token string">' ViewRendring'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="queuewatcher"><a href="#queuewatcher" aria-hidden="true" class="header-anchor">#</a> queueWatcher</h2> <p>å°† <code>Watcher</code> å¯¹è±¡è‡ªèº«ä¼ é€’ç»™ <code>queueWatcher</code> æ–¹æ³•ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> has <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> queue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> waiting <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">queueWatcher</span><span class="token punctuation">(</span><span class="token parameter">watcher</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> id <span class="token operator">=</span> watcher<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>has<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    has<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    queue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>watcher<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>waiting<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      waiting <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token function">nextTick</span><span class="token punctuation">(</span>flushSchedulerQueue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>è¿™é‡Œä½¿ç”¨ä¸€ä¸ªå«åš <code>has</code> çš„ mapï¼Œé‡Œé¢å­˜æ”¾ id -&gt; true(false) çš„å½¢å¼ï¼Œç”¨åŠ›å•Šåˆ¤æ–­æ˜¯å¦å·²ç»å­˜åœ¨ç›¸åŒçš„ <code>Watcher</code> å¯¹è±¡ï¼ˆè¿™æ ·æ¯”æ¯æ¬¡éƒ½å»éå† <code>queue</code> æ•ˆç‡ä¸Šä¼šé«˜å¾ˆå¤šï¼‰ã€‚</p> <p>å¦‚æœç›®å‰é˜Ÿåˆ— <code>queue</code> ä¸­è¿˜æ²¡æœ‰è¿™ä¸ª <code>Watcher</code> å¯¹è±¡ï¼Œåˆ™è¯¥å¯¹è±¡ä¼šè¢« <code>push</code> è¿›é˜Ÿåˆ— <code>queue</code> ä¸­å»ã€‚</p> <p><code>waiting</code> æ˜¯ä¸€ä¸ªæ ‡è®°ä½ï¼Œæ ‡è®°æ˜¯å¦å·²ç»å‘ <code>nextTick</code> ä¼ é€’äº† <code>flushSchedulerQueue</code> æ–¹æ³•ï¼Œåœ¨ä¸‹ä¸€ä¸ª tick æ‰§è¡Œæ—¶ <code>flushSchedulerQueue</code> æ–¹æ³•æ¥ flush é˜Ÿåˆ— <code>queue</code>ï¼Œæ‰§è¡Œå®ƒé‡Œé¢çš„æ‰€æœ‰ <code>Watcher</code> å¯¹è±¡çš„ <code>run</code> æ–¹æ³•ã€‚</p> <h2 id="flushschedulerqueue"><a href="#flushschedulerqueue" aria-hidden="true" class="header-anchor">#</a> flushSchedulerQueue</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">flushSchedulerQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> watcher<span class="token punctuation">,</span> id<span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span>index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> index <span class="token operator">&lt;</span> queue<span class="token punctuation">.</span>length<span class="token punctuation">;</span> index<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    watcher <span class="token operator">=</span> queue<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
    id <span class="token operator">=</span> watcher<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
    has<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    watcher<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  waiting <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æ¨¡æ‹Ÿæ›´æ–°ç›¸åŒçš„ä¾èµ–ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> watch1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> watch2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

watcher1<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
watcher1<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
watcher2<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>è¿™é‡Œå…ˆ new ä¸¤ä¸ª <code>Watcher</code> å¯¹è±¡ï¼Œå› ä¸ºä¿®æ”¹äº† <code>data</code> çš„æ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¨¡æ‹Ÿè§¦å‘äº†ä¸¤æ¬¡ <code>watch1</code> çš„ <code>update</code> ä»¥åŠä¸€æ¬¡ <code>watch2</code> çš„ <code>update</code>ã€‚</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/vue-guidebook/assets/js/app.523c8c0b.js" defer></script><script src="/vue-guidebook/assets/js/2.e151b532.js" defer></script><script src="/vue-guidebook/assets/js/22.53a27428.js" defer></script>
  </body>
</html>
